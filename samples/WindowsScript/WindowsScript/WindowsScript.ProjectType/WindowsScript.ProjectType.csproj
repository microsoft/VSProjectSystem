<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MinimumVisualStudioVersion>15.0</MinimumVisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == ''">15.0</VisualStudioVersion>
    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)</VSToolsPath>
    <NuGetPackageImportStamp>
    </NuGetPackageImportStamp>
    <TargetFrameworkProfile />
  </PropertyGroup>
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProductVersion>8.0.30703</ProductVersion>
    <SchemaVersion>2.0</SchemaVersion>
    <ProjectTypeGuids>{82b43b9b-a64c-4715-b499-d71e9ca2bd60};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids>
    <ProjectGuid>{D14ED547-03FF-4195-A5A0-2107C033C2EF}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>WindowsScript</RootNamespace>
    <AssemblyName>WindowsScript</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <SignAssembly>true</SignAssembly>
    <AssemblyOriginatorKeyFile>Key.snk</AssemblyOriginatorKeyFile>
    <StartAction>Program</StartAction>
    <StartProgram>$(DevEnvDir)devenv.exe</StartProgram>
    <StartArguments>/rootSuffix Exp</StartArguments>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <CopyVsixExtensionFiles>False</CopyVsixExtensionFiles>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="Microsoft.Win32.Primitives" />
    <Reference Include="PresentationCore" />
    <Reference Include="PresentationFramework" />
    <Reference Include="System" />
    <Reference Include="System.AppContext" />
    <Reference Include="System.ComponentModel.Composition" />
    <Reference Include="System.Configuration" />
    <Reference Include="System.Console" />
    <Reference Include="System.Core" />
    <Reference Include="System.Design" />
    <Reference Include="System.Diagnostics.Tracing" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Globalization.Calendars" />
    <Reference Include="System.IO" />
    <Reference Include="System.IO.Compression.ZipFile" />
    <Reference Include="System.IO.FileSystem" />
    <Reference Include="System.IO.FileSystem.Primitives" />
    <Reference Include="System.Linq" />
    <Reference Include="System.Linq.Expressions" />
    <Reference Include="System.Net" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Net.Sockets" />
    <Reference Include="System.Reflection" />
    <Reference Include="System.Runtime" />
    <Reference Include="System.Runtime.Extensions" />
    <Reference Include="System.Runtime.InteropServices" />
    <Reference Include="System.Security.Cryptography.Algorithms" />
    <Reference Include="System.Security.Cryptography.Encoding" />
    <Reference Include="System.Security.Cryptography.Primitives" />
    <Reference Include="System.Security.Cryptography.X509Certificates" />
    <Reference Include="System.Text.RegularExpressions" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.Xaml" />
    <Reference Include="System.Xml" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Xml.ReaderWriter" />
    <Reference Include="VSLangProj, Version=7.0.3300.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    <Reference Include="WindowsBase" />
    <Reference Include="WindowsFormsIntegration" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\WindowsScript.ProjectTemplate\WindowsScript.ProjectTemplate.csproj">
      <Project>{651ebed8-058e-4104-a3b5-2e06330822f2}</Project>
      <Name>WindowsScript.ProjectTemplate</Name>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
      <IncludeOutputGroupsInVSIX>TemplateProjectOutputGroup%3b</IncludeOutputGroupsInVSIX>
      <VSIXSubPath>ProjectTemplates</VSIXSubPath>
    </ProjectReference>
  </ItemGroup>
  <!-- 
  Resources for our new project system
  -->
  <ItemGroup>
    <EmbeddedResource Include="Resources.resx">
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <EmbeddedResource Include="VSPackage.resx">
      <MergeWithCTO>true</MergeWithCTO>
      <SubType>Designer</SubType>
    </EmbeddedResource>
  </ItemGroup>
  <ItemGroup>
    <Compile Include="MyConfiguredProject.cs" />
    <Compile Include="MyUnconfiguredProject.cs" />
    <Compile Include="ProjectProperties.cs" />
    <Compile Include="ScriptDebuggerLaunchProvider.cs" />
    <Compile Include="VsPackage.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include="app.config" />
    <None Include="source.extension.vsixmanifest">
      <SubType>Designer</SubType>
    </None>
    <None Include="Key.snk" />
  </ItemGroup>
  <!-- 
  These are the parts of the custom project system which will be deployed as part of the 
  final implementation, and provide the basic processing for handling rules in CPS.
  -->
  <ItemGroup>
    <None Include="BuildSystem\DeployedBuildSystem\WindowsScript.props" />
    <None Include="BuildSystem\DeployedBuildSystem\WindowsScript.targets" />
  </ItemGroup>
  <!--
  The XAML files provide buth compile-time implementations for CPS rules as well as
  runtime information for property pages.  They will also be deployed as part of the
  final package.
  -->
  <ItemGroup>
    <None Include="BuildSystem\Rules\ProjectItemsSchema.xaml">
      <SubType>Designer</SubType>
    </None>
    <None Include="BuildSystem\Rules\script.browseobject.xaml">
      <SubType>Designer</SubType>
    </None>
    <XamlPropertyRule Include="BuildSystem\Rules\general.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\general_file.xaml">
      <RuleInjection>None</RuleInjection>
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\folder.xaml">
      <RuleInjection>None</RuleInjection>
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\none.xaml">
      <RuleInjection>None</RuleInjection>
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\scc.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\debugger_general.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\script.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\general.browseobject.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
    <XamlPropertyRule Include="BuildSystem\Rules\ScriptDebugger.xaml">
      <SubType>Designer</SubType>
    </XamlPropertyRule>
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <Import Project="$(VSToolsPath)\VSSDK\Microsoft.VsSDK.targets" Condition="'$(VSToolsPath)' != ''" />
  <!-- This will include the msbuild files and rules files in the VSIX file, installed under 
       MSBuildExtensionsPath ([Visual Studio Install Path]\MSBuild). This gives the files a well-known
       location, so projects can import these files and work for different users on the same machine, or work
       on different machines when VS is installed on a different path, as long as the VSIX was installed.
       NOTE: The VSIX manifest needs the "This VSIX is installed for all users (requires elevation on install)"
       checkbox to be checked. -->
  <ItemGroup>
    <VSIXSourceItem Include="BuildSystem\DeployedBuildSystem\**">
      <InProject>false</InProject>
      <InstallRoot>MSBuild</InstallRoot>
      <VSIXSubPath>CustomProjectSystems\WindowsScript</VSIXSubPath>
    </VSIXSourceItem>
    <VSIXSourceItem Include="BuildSystem\Rules\**">
      <InProject>false</InProject>
      <InstallRoot>MSBuild</InstallRoot>
      <VSIXSubPath>CustomProjectSystems\WindowsScript\Rules</VSIXSubPath>
    </VSIXSourceItem>
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.VisualStudio.ProjectSystem.Sdk">
      <Version>17.2.402-pre</Version>
    </PackageReference>
    <PackageReference Include="Microsoft.VisualStudio.SDK">
      <Version>17.8.37222</Version>
    </PackageReference>
  </ItemGroup>
  <!-- Although the above causes the VSIX to contain the MSBuild and rules files, the automatic deploy of the
       VSIX to the experimental instance of Visual Studio on build does not copy the files to the MSBuild
       location. In order to simplify development, we'll copy the files to a different well-known location. To
       avoid needed to run Visual Studio as administrator, or overwriting the files installed by the VSIX,
       we'll copy to a different location, in the current user's profile. However, this requires any project
       used to test the project system to import the files from a different location than to use the project
       system installed from the VSIX. -->
  <Target Name="AfterBuild">
    <ItemGroup>
      <BuildSystemToCopy Include="BuildSystem\DeployedBuildSystem\**\*" />
      <RulesToCopy Include="BuildSystem\Rules\**\*" />
    </ItemGroup>
    <Copy SourceFiles="@(BuildSystemToCopy)" DestinationFiles="@(BuildSystemToCopy->'$(LocalAppData)\CustomProjectSystems\WindowsScript\%(RecursiveDir)%(FileName)%(Extension)')" SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(RulesToCopy)" DestinationFiles="@(RulesToCopy->'$(LocalAppData)\CustomProjectSystems\WindowsScript\Rules\%(RecursiveDir)%(FileName)%(Extension)')" SkipUnchangedFiles="true" />
  </Target>
</Project>